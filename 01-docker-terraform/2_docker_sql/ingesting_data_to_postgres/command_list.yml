# to add environment variables in docker is with th eflag -e

# to mount volumnes we map the postgres data in the local
# machine folder to the container with -v
# windows needs the full path 
# linux/mac you can $(pwd)/ to substitute the path

# -p to map a port to a port of the container

# 5432 port of the postgres


docker run -it \
  --name postgres-test \
  -e POSTGRES_USER="root" \
  -e POSTGRES_PASSWORD="root" \
  -e POSTGRES_DB="ny_taxi" \
  -v /e/Documentos/Resources_apuntes/data-engineer-zoomcamp-2024/2_docker_sql/ingesting_data_to_postgres/ny_taxi_postgres_data:/var/lib/postgresql/data \
  -p 5432:5432 \
  --network pgadmin-network \
       postgres:13

# pgcli -h localhost -p 5432 -u root -d ny_taxi

docker run -it \
  --name postgres-test \
  -e POSTGRES_USER="root" \
  -e POSTGRES_PASSWORD="root" \
  -e POSTGRES_DB="ny_taxi" \
  -v /$(pwd)/ny_taxi_postgres_data:/var/lib/postgresql/data \
  -p 5432:5432 \
  --network pgadmin-network \
  postgres:13

# To run pgAdmin
# localhost: to connect the database we have to link the pgadmin container to the db -> put a network (docker network create)

docker run -it \
  --name pgadmin-test \
  -e PGADMIN_DEFAULT_EMAIL="admin@admin.com" \
  -e PGADMIN_DEFAULT_PASSWORD="root" \
  -p 8080:80 \
  --network pgadmin-network \
       dpage/pgadmin4


# To create a network:
docker network create network_name

# To add a network to the container: --network: network_name

# To enter to the database from pgamin: 
# right click in servers -> create or register -> server -> connection -> host name/addres: name of the postgres container


# docker build -t taxi_ingest::v001 .


# docker run -it \
# --network=pgadmin-network \
# taxi_ingest:v001 \
#    --user=root \
#    --password=root \
#    --host=postgres-test \
#    --port=5432 \
#    --db=ny_taxi \
#    --table_name=green_taxi \
#    --url=${URL} \
#    --cleaning_fun=cleaning_taxi_data

# docker-compose up 